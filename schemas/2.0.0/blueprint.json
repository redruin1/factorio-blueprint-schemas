{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "2.0.0/blueprint.json",
    "title": "Blueprint Root",
    "description": "A regular blueprint, which can contain entities, tiles, schedules, wire connections, stock connections, in addition to additional metadata.",
    "$defs": {
        "wire-connector-id": {
            "title": "Wire Connector ID",
            "anyOf": [
                {
                    "title": "Circuit Red", 
                    "description": "`wire_connector_id.circuit_red`", 
                    "const": 1
                },
                {
                    "title": "Circuit Green", 
                    "description": "`wire_connector_id.circuit_green`", 
                    "const": 2
                },
                {
                    "title": "Circuit Red Input", 
                    "description": "`wire_connector_id.combinator_input_red`", 
                    "const": 1
                },
                {
                    "title": "Circuit Green Input", 
                    "description": "`wire_connector_id.combinator_input_green`", 
                    "const": 2
                },
                {
                    "title": "Circuit Red Output", 
                    "description": "`wire_connector_id.combinator_output_red`", 
                    "const": 3
                },
                {
                    "title": "Circuit Green Output", 
                    "description": "`wire_connector_id.combinator_output_green`", 
                    "const": 4
                },
                {
                    "title": "Power Wire", 
                    "description": "`wire_connector_id.pole_copper`", 
                    "const": 5
                },
                {
                    "title": "Power Switch Left", 
                    "description": "`wire_connector_id.power_switch_left_copper`", 
                    "const": 5
                },
                {
                    "title": "Power Switch Right", 
                    "description": "`wire_connector_id.power_switch_right_copper`", 
                    "const": 6
                }
            ]
        },
        "schedule-stop": {
            "type": "object",
            "properties": {
                "station": {
                    "title": "Station",
                    "description": "The name of the stop. Either the name of a train stop or the name of a planet, depending on the type of schedule.",
                    "type": "string"
                },
                "wait_conditions": {
                    "title": "Wait Conditions",
                    "description": "A list of wait condition objects, conjoined by their `compare_type`. The `compare_type` of each wait condition interacts with the previous wait condition object.",
                    "type": "array",
                    "items": {
                        "title": "Wait Condition",
                        "type": "object",
                        "properties": {
                            "type": {
                                "enum": ["TODO"]
                            },
                            "compare_type": {
                                "enum": ["or", "and"],
                                "default": "or"
                            }
                        }
                    }
                }
            }
        },
        "locomotive-schedule": {
            "title": "Locomotive Schedule",
            "type": "object",
            "properties": {
                "records": {
                    "type": "array",
                    "items": {"$ref": "#/$defs/schedule-stop"}
                },
                "interrupts": {
                    "title": "Interrupts",
                    "description": "TODO"
                }
            }
        },
        "space-platform-schedule": {
            "title": "Space Platform Schedule",
            "type": "object",
            "properties": {
                "records": {
                    "type": "array",
                    "items": {"$ref": "#/$defs/schedule-stop"}
                },
                "interrupts": {
                    "title": "Interrupts",
                    "description": "TODO"
                }
            }
        },
        "schedule": {
            "title": "Schedule",
            "description": "An object which encodes a list of consecutive stops as well as a number of entities configured to proceed between those stops. Includes both locomotive schedules as well as space platform schedules.",
            "type": "object",
            "properties": {
                "locomotives": {
                    "type": "array",
                    "items": {
                        "description": "The `entity_number` of a locomotive or space platform hub which has this schedule.",
                        "$ref": "../common/uint64.json"
                    }
                },
                "schedule": {
                    "oneOf": [
                        {"$ref": "#/$defs/locomotive-schedule"},
                        {"$ref": "#/$defs/space-platform-schedule"}
                    ]
                }
            },
            "examples": [
                {
                    "locomotives": [1],
                    "schedule": {
                        "records": [
                            {
                                "station": "nauvis",
                                "wait_conditions": [
                                    {
                                        "type": "all_requests_satisfied",
                                        "compare_type": "and"
                                    }
                                ]
                            },
                            {
                                "station": "vulcanus",
                                "wait_conditions": [
                                    {
                                        "type": "any_request_zero",
                                        "compare_type": "and"
                                    }
                                ]
                            }
                        ],
                        "interrupts": [
                            {
                                "name": "Interrupt name",
                                "conditions": [
                                    {
                                        "type": "damage_taken",
                                        "compare_type": "and",
                                        "damage": 1000
                                    }
                                ],
                                "targets": [
                                    {
                                        "station": "nauvis",
                                        "wait_conditions": [
                                            {
                                                "type": "passenger_not_present",
                                                "compare_type": "and"
                                            }
                                        ]
                                    },
                                    {
                                        "station": "vulcanus",
                                        "wait_conditions": [
                                            {
                                                "type": "item_count",
                                                "compare_type": "and",
                                                "condition": {
                                                    "first_signal": {
                                                        "name": "inserter"
                                                    },
                                                    "constant": 100,
                                                    "comparator": "\u2264"
                                                }
                                            }
                                        ],
                                        "allows_unloading": false
                                    }
                                ],
                                "inside_interrupt": true
                            }
                        ]
                    }
                }
            ]
        },
        "stock-connection": {
            "title": "Stock Connection",
            "description": "An object which documents whether or not a particular RollingStock entity has connections to any other RollingStock.",
            "type": "object",
            "properties": {
                "stock": {
                    "description": "`entity_number` of the locomotive or wagon whose connections are being specified.",
                    "$ref": "urn:uint64"
                },
                "front": {
                    "description": "`entity_number` of the locomotive or wagon connected to the front of this `stock`.",
                    "$ref": "urn:uint64"
                },
                "back": {
                    "description": "`entity_number` of the locomotive or wagon connected to the front of this `stock`.",
                    "$ref": "urn:uint64"
                }
            },
            "required": ["stock"],
            "examples": [
                {
                    "stock": 2,
                    "front": 1,
                    "back": 3
                },
                {
                    "stock": 4
                }
            ]
        }
    },
    "type": "object",
    "properties": {
        "index": {
            "title": "Index",
            "description": "The unique index of the blueprint, if it lies inside of a parent blueprint book. If not inside of a blueprint book, this key has no effect.",
            "oneOf": [
                {"$ref": "../common/uint16.json"},
                {"title": "Null", "type": "null"}
            ]
        },
        "blueprint": {
            "title": "Blueprint Object",
            "description": "Main object of the blueprint, which actually contains the majority of its keys.",
            "type": "object",
            "properties": {
                "item": {
                    "title": "Item",
                    "description": "The name of the item associated with this blueprintable.",
                    "const": "blueprint"
                },
                "label": {
                    "title": "Label",
                    "description": "The player-given title of this blueprint. Can be specified with rich text colors and icons. If omitted or specified as an empty string, then the blueprint is given the default name 'Blueprint'.",
                    "type": "string",
                    "default": ""
                },
                "label_color": {
                    "title": "Label Color",
                    "description": "The color of the label. If omitted, this color defaults to a special hybrid color, where it is white in your inventory and black when being placed.",
                    "$ref": "../common/color.json"
                },
                "description": {
                    "title": "Description",
                    "description": "The player-given description of this blueprint. Can be specified with rich text colors and icons.",
                    "type": "string",
                    "default": ""
                },
                "icons": {
                    "title": "Icons",
                    "description": "The list of icons to display over the blueprint item, with a maximum of 4 icons total.",
                    "type": "array",
                    "items": {
                        "$ref": "common/icon.json"
                    },
                    "maxItems": 4
                },
                "version": {
                    "title": "Version",
                    "description": "The version of the game associated with this blueprint string. Encoded as four bytes, where each byte corresponds to a semantic version number.",
                    "$ref": "../common/uint64.json"
                },
                "snap-to-grid": {
                    "title": "Snap to Grid",
                    "description": "A snapping grid with a width (`x`) and height (`y`) to apply when placing this blueprint. If this field is omitted, this means the blueprint has no snapping grid.",
                    "$ref": "../common/position.json"
                },
                "absolute-snapping": {
                    "title": "Absolute Snapping",
                    "description": "Whether or not this blueprint will use absolute coordinates when snapping to it's defined snapping grid. If no snapping grid is defined, this key does nothing.",
                    "type": "boolean",
                    "default": true
                },
                "position-relative-to-grid": {
                    "title": "Position Relative to Grid",
                    "description": "The coordinate offset to give the snapping grid (as indicated by the flag icon in the Blueprint's inspection GUI).",
                    "$ref": "../common/position.json",
                    "default": {"x": 0, "y": 0}
                },
                "entities": {
                    "title": "Entities",
                    "description": "The list of all entities stored inside this blueprint.",
                    "type": "array",
                    "items": {
                        "anyOf": [
                            {"$ref": "entity/accumulator.json"},
                            {"$ref": "entity/agricultural-tower.json"},
                            {"$ref": "entity/ammo-turret.json"},
                            {"$ref": "entity/arithmetic-combinator.json"},
                            {"$ref": "entity/artillery-turret.json"},
                            {"$ref": "entity/artillery-wagon.json"},
                            {"$ref": "entity/assembling-machine.json"},
                            {"$ref": "entity/asteroid-collector.json"}
                        ]
                    },
                    "default": [],
                    "TODO": [
                        {"$ref": "entity/beacon.json"},
                        {"$ref": "entity/boiler.json"},
                        {"$ref": "entity/burner-generator.json"},
                        {"$ref": "entity/car.json"},
                        {"$ref": "entity/cargo-bay.json"},
                        {"$ref": "entity/cargo-landing-pad.json"},
                        {"$ref": "entity/cargo-wagon.json"},
                        {"$ref": "entity/constant-combinator.json"},
                        {"$ref": "entity/container.json"},
                        {"$ref": "entity/curved-rail-a.json"},
                        {"$ref": "entity/curved-rail-b.json"},
                        {"$ref": "entity/decider-combinator.json"}
                    ]
                },
                "tiles": {
                    "title": "Tiles",
                    "description": "The list of all tiles stored inside this blueprint.",
                    "type": "array",
                    "items": {
                        "$ref": "urn:factorio:tile"
                    },
                    "default": []
                },
                "wires": {
                    "title": "Wires",
                    "description": "The list of all wire connections stored inside this blueprint, including both power and circuit wires.",
                    "type": "array",
                    "items": {
                        "type": "array",
                        "prefixItems": [
                            {
                                "$ref": "../common/uint64.json",
                                "description": "`entity_number` of the first entity being connected."
                            },
                            {
                                "description": "What kind of connection the wire has to the first entity. See [`wire_connector_id`](https://lua-api.factorio.com/latest/defines.html#defines.wire_connector_id).",
                                "$ref": "#/$defs/wire-connector-id"                                
                            },
                            {
                                "$ref": "../common/uint64.json",
                                "description": "`entity_number` of the second entity being connected."
                            },
                            {
                                "description": "What kind of connection the wire has to the second entity. See [`wire_connector_id`](https://lua-api.factorio.com/latest/defines.html#defines.wire_connector_id).",
                                "$ref": "#/$defs/wire-connector-id"
                            }
                        ],
                        "items": false
                    },
                    "default": []
                },
                "schedules": {
                    "title": "Schedules",
                    "description": "The list of all schedules in this blueprint, including both train and space platform schedules.",
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/schedule"
                    },
                    "default": []
                },
                "stock_connections": {
                    "title": "Stock Connections",
                    "description": "An explicit list of all connections between rolling stock.",
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/stock-connection"
                    },
                    "default": []
                }
            }
        }
    }
}